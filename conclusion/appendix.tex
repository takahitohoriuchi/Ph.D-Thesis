\part*{付録}
% 目次にも表示させる
\addcontentsline{toc}{part}{付録}
\setcounter{chapter}{0} % 章番号をリセット
% \chapter{物語についての付録}
\chapter{HJ-Playgroundの付録}


\section{最近傍マーカの計算法}
コンピュータグラフィックスの処理課程（グラフィックスパイプラインもしくはレンダリングパイプライン）は、以下の流れである。
たとえば、ある3点があるとして説明する。
\begin{enumerate}
  \item モデリング：世界座標系において、対象の3次元位置座標を決める
  \item 視点変換：対象をカメラからの眺めに変換（世界座標系からカメラ座標系への並行移動）
  \item （カリング）
  \item クリッピング
  \item （ラスタライズ）
  \item 画面に出力
\end{enumerate}
なお、ベクトルはボールド体で表記する。
空間にある2つのマーカの3次元位置座標$\bm{p}$,$\bm{ q}$と、画面上のマウスカーソルの2次元座標$\bm{m}$の「距離」$d$を算出する。
マーカの位置をそれぞれ、
$$
  \bm{p} =
  \begin{pmatrix}
    {p_x} \\
    {p_y} \\
    {p_z}
  \end{pmatrix}
  ,
  \bm{q} =
  \begin{pmatrix}
    {q_x} \\
    {q_y} \\
    {q_z}
  \end{pmatrix}
  ,
  \bm{m} =
  \begin{pmatrix}
    {m_x} \\
    {m_y} \\
    {m_z}
  \end{pmatrix}
$$

モデル行列は今回は関係ない。
カメラの外部パラメータと内部パラメータによって、変換ができる。

カメラの外部パラメータは、以下３つからなる。
\begin{itemize}
  \item 世界座標系におけるカメラ位置（3次元ベクトル）
  \item 世界座標系におけるカメラ注視点（3次元ベクトル）
  \item 世界座標系におけるカメラ上方向（3次元ベクトル）
\end{itemize}
これら3つの情報は、1つの「ビュー行列」にまとめて表現できる。
$$
\mathbf{V} = 
\begin{pmatrix}
r_{11} & r_{12} & r_{13} & t_x \\
r_{21} & r_{22} & r_{23} & t_y \\
r_{31} & r_{32} & r_{33} & t_z \\
0 & 0 & 0 & 1
\end{pmatrix}
$$


カメラの内部パラメータは、以下4つ
\footnote{
  これら4つの情報をもちいて、図のように、カメラからみた世界全体から、ある「四角錐台」の領域を一意に定めている。
  この四角錐台の領域のみ、「カメラに映り込む世界」として切り取るわけだ。なぜ直方体ではなく四角錐台なのか？
  それは「カメラに近ければ近いほど大きく写り、遠ければ遠いほど小さく映る」ということを反映するためである。
  このあと四角錐台を、２つの底面を押しつぶすように、二次元平面へと圧縮するが、それで反映される。
}
からなる。
\begin{itemize}
  \item 焦点距離
  \item アスペクト比
  \item ニアクリップとファークリップ平面の距離
  \item 視野（Field of View, FoV）
\end{itemize}
これら4つの情報は、1つの「プロジェクション行列」にまとめて表現できる。
% ビュー行列をかける
$$
\mathbf{P} = 
\begin{pmatrix}
\frac{1}{\tan(\text{FOV}/2) \times \text{aspect}} & 0 & 0 & 0 \\
0 & \frac{1}{\tan(\text{FOV}/2)} & 0 & 0 \\
0 & 0 & \frac{f+n}{f-n} & \frac{2fn}{f-n} \\
0 & 0 & -1 & 0
\end{pmatrix}
$$

したがって、対象点の3次元ベクトルに、ビュー行列をかけてからプロジェクション行列をかけることで、
変換後の画面座標系で表された2次元ベクトル$\bm{p'} =
\begin{pmatrix}
  {p'_x} \\
  {p'_y} \\    
\end{pmatrix}
$が得られる。

$$
\bm{p'} =  
  \mathbf{P} \mathbf{V} \bm{p}
  =
  \begin{pmatrix}
    \frac{1}{\tan(\text{FoV}/2) \times \text{aspect}} & 0 & 0 & 0 \\
    0 & \frac{1}{\tan(\text{FoV}/2)} & 0 & 0 \\
    0 & 0 & \frac{f+n}{f-n} & \frac{2fn}{f-n} \\
    0 & 0 & -1 & 0
    \end{pmatrix}
    \begin{pmatrix}
      r_{11} & r_{12} & r_{13} & t_x \\
      r_{21} & r_{22} & r_{23} & t_y \\
      r_{31} & r_{32} & r_{33} & t_z \\
      0 & 0 & 0 & 1
    \end{pmatrix}    
    \begin{pmatrix}
    {p_x} \\
    {p_y} \\
    {p_z} \\
    {1}
    \end{pmatrix}
$$

すべてのマーカ（n個）に対して、これらの画面上2次元座標を求め、
そのそれぞれとマウスカーソルとの距離を求める（$d_1, d_2, ..., d_n$）。
あらかじめ画面2次元平面上でマウスカーソルを中心とした一定の半径$r$内にある点群を、「カーソル近傍マーカ」とするようにしておき、
$r > d$を満たす点群を求める。

「カーソル近傍マーカ」群のうちもっとも「カメラからみて手前」にあるものを、「最近傍マーカ」とする。



\section{アプリ開発にもちいたJavaScriptパッケージ}
% \textcolor{red}{あかーーいテキストfeiji}
% 以下がnpmパッケージ一覧である。
\begin{lstlisting}
  {
    //コメント
    "@mediapipe/pose": "^0.5.1675469404",
    "core-js": "^3.8.3",
    "firebase": "^9.7.0",
    "firebase-admin": "^10.1.0",
    "hashids": "^2.3.0",
    "lodash": "^4.17.21",
    "matrixgl": "^2.0.0",
    "p5": "^1.4.1",
    "vue": "^2.6.14",
    "vue-router": "^3.5.1",
    "vuetify": "^2.6.0"
  }
\end{lstlisting}



  % {
  %   "name": "template",
  %   "version": "0.1.0",
  %   "private": true,
  %   "scripts": {
  %     "serve": "vue-cli-service serve",
  %     "build": "vue-cli-service build",
  %     "lint": "vue-cli-service lint"
  %   },
  %   "dependencies": {
  %     "@mediapipe/pose": "^0.5.1675469404",
  %     "core-js": "^3.8.3",
  %     "firebase": "^9.7.0",
  %     "firebase-admin": "^10.1.0",
  %     "hashids": "^2.3.0",
  %     "lodash": "^4.17.21",
  %     "matrixgl": "^2.0.0",
  %     "p5": "^1.4.1",
  %     "vue": "^2.6.14",
  %     "vue-router": "^3.5.1",
  %     "vuetify": "^2.6.0"
  %   },
  %   "devDependencies": {
  %     "@babel/core": "^7.12.16",
  %     "@babel/eslint-parser": "^7.12.16",
  %     "@vue/cli-plugin-babel": "~5.0.0",
  %     "@vue/cli-plugin-eslint": "~5.0.0",
  %     "@vue/cli-plugin-router": "~5.0.0",
  %     "@vue/cli-service": "~5.0.0",
  %     "eslint": "^7.32.0",
  %     "eslint-plugin-sort-imports-es6-autofix": "^0.6.0",
  %     "eslint-plugin-vue": "^8.0.3",
  %     "sass": "~1.32.0",
  %     "sass-loader": "^10.0.0",
  %     "vue-cli-plugin-vuetify": "~2.4.8",
  %     "vue-template-compiler": "^2.6.14",
  %     "vuetify-loader": "^1.7.0"
  %   }
  % }  


%   \chapter{Q\&A}
%   \begin{enumerate}[label=\textbf{Q\arabic*.}]
%     \item \textbf{「学び」は、ニューラルネットワークでの「学習」となにがちがうのですか？NNでは新しい学習データを流しこむとネットワーク全体が多少なり更新されますが、これは「学ぶ自己を変革する」とはちがうのですか？}
%     \begin{enumerate}[label=\textbf{A.}]
%         \item 良い質問です。認知を知覚・行動・思考という３モジュールの関係性として考えてみましょう。
%         NNの学習前後では、なにが変わるでしょうか？
%         「入力が変わる」というのがひとつでしょうか。
%     \end{enumerate}
%   \end{enumerate}

%   \begin{enumerate}[label=\textbf{Q\arabic*.}]
%     \item \textbf{「もの-こと」と「主観-客観」の関係性がこんがらがってます。}
%     \begin{enumerate}[label=\textbf{A.}]
%         \item 
%       「もの-こと」は、私たちにこびりついてしまった「主観-客観」の意味を、本来のあり方にとらえなおすために表記しなおしていると考えるのがよいです。
%       いわゆる「主観」と「客観」は、互いに別個の存在（見方のモード）であるとされますよね。
%       その限りで、主観と客観は足し算的に表記できると言えるでしょう。
%       「すべて = 主観 + 客観」というふうに。
%       このありかたに意を唱えるために、「もの-こと」はあります。
%       通常「ーというもの」、「ーということ」という用法をみればわかるように、
%       ものとことは、不思議な関係にあります。
%       木村敏は、「こと」は、「もの」と「こと」とが「あいだ」を保っていてこそ、「こと」として在れる、と説いています。
%       「もの」と「こと」を相独立する二元として扱うと、そこに「あいだ」は消失するわけです。
%         つまりこの限りにおいて、決して「もの」はいわゆる客観とは異なり、「こと」はいわゆる主観」とは異なることがわかるでしょう。
        
%         あえて数式的に書くならば、
%         「もの=主観+客観」、「こと=主観*客観」だと著者は考えます。
%         先ほど足し算で表記したような「アリストテレス的論理」とは、そもそも論理として異なるわけですね。
%         あいだ論理、とでもいえましょうか。                    
%     \end{enumerate}
%   \end{enumerate}






%   \chapter{哲学的なあれこれ}
%   \section{概念整理}
%   哲学思想を整理しておく。以下、「唯物主義」など、通常哲学用語として聞きなれない表記をしていることがある。
%   通常、"materialism"は「唯物論」と訳される。
%   しかし本論文では、"-logy"という英語は「〜論」、"-ism"という英語は「主義」と訳すよう統一している。
    
%   \begin{description}
%     \item [存在論（ontology）]\mbox{}\\
%     「存在」とはなにか、いかなるものごとなのか、を探究する学問のこと。
%     存在を考える立場には以下の種類がある。
%     \item 
%       \begin{description}
%         \item [唯物主義（materialism）]\mbox{}\\
%         存在は物質現象がまず基本にあり、それがもとになって、精神現象が生じる、という考え方。
%         \item [唯心主義（idealism）]\mbox{}\\
%         存在は精神現象がまず基本にあり、物質的世界とは、精神が「思う」ことによる産物である、という考え方。
%       \end{description}
%     \item [認識論（epistemology）]\mbox{}\\
%       「認識・知識」とはなにか、いかなるものか、ひとはどのように認識を得ているのか、を探究する学問のこと。
%       認識を考える立場には以下の種類がある。
%       \begin{description}
%         \item[観念主義（idealism, in a different sense）]\mbox{}\\
%         我々の知識や認識するものごとは、アプリオリ「世界」を反映しているのではなく、主観的な要素から構成している、という考え方。
%         イギリス経験論（empiricism）
%         ロック・バークリー・ヒュームはこの観念主義に立つ。
%       \end{description}
%       \begin{description}
%         \item[実在主義（realism）]\mbox{}\\
%         我々の知識や認識するものごとは、ア・プリオリな「外部世界」を強調する考え方。
%         大陸合理論（rationalism）は、これと近いっちゃ近い。デカルト・スピノザ・ライプニッツ。
%         デカルトの主張は、人間は「（神なる）理性」によって、実在する外部世界をそのまま認識できる、というもの。
%       \end{description}  
%       \begin{description}
%         \item[構成主義（constructivism）]\mbox{}\\
%         個々の学習者が、自らの既存の知識や文脈に依存しながら、現場においてそれらを統合して新しい知識を獲得してゆく。
%         学習/教育心理学や認知心理学に多い。
%         多くの認知科学はこれかもしれない。ピアジェ、ヴィゴツキー、ナイサーなど。
%         ギブソンは、実在主義でありながらも構成主義を反映している、という不思議なありかた。
%       \end{description}
%   \end{description}

%   \section{簡単な事例：色の知覚}
% 視覚の原始的な例として、色の知覚を取り上げる。
% 色とは私たちの意識にのぼる「質」である。色そのものは、世界には存在しない。
% 光刺激は、波とみなせ、波長をもつ。人間は、およそ400〜800nmの光を知覚することができる。
% 「光波長」と「色」の対応があり、およそ、400nmが紫、500nmが緑、800nmが赤として、色のグラデーションとなる。
% なぜこうなるか。受容器には錐体細胞がある。錐体細胞は、次のグラフのようになる。

% つまり、マゼンダ色に対応する単色光は、世界には存在しない。いわば私たちが脳で作り出している色なのだ。
% このように、色の知覚という原始的な例において、しかも処理の「上流」ですでに、
% 私たちは「世界をそのままコピー」してはいない。世界を構成しているのだ。

% 知覚相は、認識以前の世界ではない。世界の「姿形」という「質」を、作り出したものである。

  % ギモン：存在論と認識論じたいも、すでに対立構造fにみえる。それらの内側階層にて２種類の主義思想が対立しているのみならず。